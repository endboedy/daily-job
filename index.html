<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Monitoring Equipment</title>
  <style>
    body{font-family:Arial, sans-serif; margin:20px;}
    table{width:100%; border-collapse:collapse; margin-top:10px;}
    th,td{border:1px solid #aaa; padding:6px; font-size:14px;}
    th{background:#f0f0f0;}
    .actions button{margin:2px;}
    .toolbar{margin-bottom:10px;}
    input,select{width:100%; box-sizing:border-box;}
  </style>
</head>
<body>
  <h2>ðŸ“Š Monitoring Equipment</h2>

  <div class="toolbar">
    <button onclick="addRow()">âž• Tambah Baris</button>
    <button onclick="exportJSON()">ðŸ’¾ Export JSON</button>
    <input type="file" accept=".json" onchange="importJSON(event)">
    <input id="filter" placeholder="ðŸ” Cari data..." onkeyup="render()">
  </div>

  <table>
    <thead>
      <tr>
        <th>Equipment</th>
        <th>Actual Down Time</th>
        <th>LTR Status</th>
        <th>Component Code</th>
        <th>Action Plan</th>
        <th>Location</th>
        <th>BD Aging Days</th>
        <th>Est RFU</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    let rows = [];

    function render() {
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";
      const q = document.getElementById("filter").value.toLowerCase();

      rows.filter(r => 
        Object.values(r).some(v => String(v).toLowerCase().includes(q))
      ).forEach((row,i)=>{
        const tr = document.createElement("tr");
        if(row.editing){
          tr.innerHTML = `
            <td><input value="${row.equipment||""}" id="eq_${i}"></td>
            <td><input type="datetime-local" value="${row.downTime||""}" id="dt_${i}"></td>
            <td><input value="${row.status||""}" id="st_${i}"></td>
            <td><input value="${row.component||""}" id="cp_${i}"></td>
            <td><input value="${row.plan||""}" id="pl_${i}"></td>
            <td><input value="${row.location||""}" id="lc_${i}"></td>
            <td><input type="number" value="${row.aging||""}" id="ag_${i}"></td>
            <td><input type="date" value="${row.rfu||""}" id="rf_${i}"></td>
            <td class="actions">
              <button onclick="saveRow(${i})">Save</button>
              <button onclick="cancelEdit(${i})">Cancel</button>
            </td>
          `;
        } else {
          tr.innerHTML = `
            <td>${row.equipment||""}</td>
            <td>${row.downTime||""}</td>
            <td>${row.status||""}</td>
            <td>${row.component||""}</td>
            <td>${row.plan||""}</td>
            <td>${row.location||""}</td>
            <td>${row.aging||""}</td>
            <td>${row.rfu||""}</td>
            <td class="actions">
              <button onclick="editRow(${i})">Edit</button>
              <button onclick="deleteRow(${i})">Delete</button>
            </td>
          `;
        }
        tbody.appendChild(tr);
      });
    }

    function addRow(){
      rows.push({editing:true});
      render();
    }

    function editRow(i){
      rows[i].editing = true;
      render();
    }

    function saveRow(i){
      rows[i] = {
        equipment: document.getElementById("eq_"+i).value,
        downTime: document.getElementById("dt_"+i).value,
        status: document.getElementById("st_"+i).value,
        component: document.getElementById("cp_"+i).value,
        plan: document.getElementById("pl_"+i).value,
        location: document.getElementById("lc_"+i).value,
        aging: document.getElementById("ag_"+i).value,
        rfu: document.getElementById("rf_"+i).value,
        editing:false
      };
      render();
    }

    function cancelEdit(i){
      rows[i].editing = false;
      render();
    }

    function deleteRow(i){
      if(confirm("Hapus baris ini?")){
        rows.splice(i,1);
        render();
      }
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(rows,null,2)],{type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "equipment.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(event){
      const file = event.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        rows = JSON.parse(e.target.result).map(r=>({...r,editing:false}));
        render();
      }
      reader.readAsText(file);
    }

    render();
  </script>
</body>
</html>
